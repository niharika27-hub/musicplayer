<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Catifyy</title>
  <link rel="stylesheet" href="index.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" integrity="sha512-Evv84Mr4kqVGRNSgIGL/F/aIDqQb7xQ2vcrdIwxfjThSH8CSR7PBEakCr51Ck+w+/U6swU2Im1vVX0SVk9ABhg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>
<body>

  <!-- React Navbar (replaces static HTML navbar) -->
  <div id="react-navbar-root"></div>

  <!-- Load React and ReactDOM from CDN -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  
  <!-- React Navbar Component -->
  <script src="navbar-component.js"></script>
      </nav>
    </div>
  </header>

  <main class="container stack-32">
   
    <section class="hero">
      <div class="player neu">
        <div class="player-main">
          <div class="album" >
            <img src="./images/jabwemet2.jpg" alt="Album art" />
          </div>
          <div class="title">Tum se hi</div>
          <div class="subtitle">Pritam</div>

          <div class="controls" >
            <button class="icon-btn" >
              <svg width="18" height="18" viewBox="0 0 24 24" aria-hidden="true"><path fill="currentColor" d="M6 6h2v12H6zM20 6v12L9 12z"/></svg>
            </button>
            <button class="play" >
              <svg width="20" height="20" viewBox="0 0 24 24" aria-hidden="true"><path fill="currentColor" d="M8 5v14l11-7z"/></svg>
            </button>
            <button class="icon-btn" >
              <svg width="18" height="18" viewBox="0 0 24 24" aria-hidden="true"><path fill="currentColor" d="M16 6h2v12h-2zM4 6v12l11-6z"/></svg>
            </button>
          </div>

          <div class="progress-wrap" >
            <div class="time"><span>1:21</span><span>3:46</span></div>
            <input type="range" min="5" max="100" value="40"  />
          </div>
        </div>
      </div>

      <aside class="stack-24">
        <div class="section neu" style="padding:20px;">
          <h2>Playing Now</h2>
          <div class="list">
            <div class="row">
              <div class="thumb"><img src="./images/gul.jpg" alt="Artwork thumbnail"/></div>
              <div class="meta">
                <div>Gul</div>
                <small>Anuv jain</small>
              </div>
              <button class="icon-btn" aria-label="Play">
                <svg width="16" height="16" viewBox="0 0 24 24" ><path fill="currentColor" d="M8 5v14l11-7z"/></svg>
              </button>
            </div>
            <div class="row">
              <div class="thumb"><img src="./images/perfect.jpg" alt="Artwork thumbnail"/></div>
              <div class="meta">
                <div>Perfect</div>
                <small>Ed Sheeran</small>
              </div>
              <button class="icon-btn" aria-label="Play">
                <svg width="16" height="16" viewBox="0 0 24 24" ><path fill="currentColor" d="M8 5v14l11-7z"/></svg>
              </button>
            </div>
          </div>
        </div>

        <div class="section cta">
          <h2>Create your perfect playlist</h2>
          <p class="muted">Collect favorites, reorder tracks, and share with friends.</p>
          <a class="btn btn-primary" href="./create.html" >+ Create Playlist</a>
        </div>
      </aside>
    </section>

    
    <section class="section">
      <h2>Trending Songs</h2>
      <div class="scroll-row">
        
        <article class="card" data-src="audio/diewithasmile.mp3">
          <div class="cover">
            <img src="./images/diewithasmile.jpg" alt="Trending song cover" />
          </div>
          <div style="margin-top:10px;"><strong>Die with a Smile</strong><br><span class="muted">Lady Gaga</span></div>
          <div class="play-overlay" >
            <svg width="16" height="16" viewBox="0 0 24 24"><path fill="#fff" d="M8 5v14l11-7z"/></svg>
          </div>
        </article>

        <article class="card" data-src="audio/gul.mp3">
          <div class="cover">
            <img src="./images/gul.jpg" alt="Trending song cover" />
          </div>
          <div style="margin-top:10px;"><strong>Gul</strong><br><span class="muted">Anuv Jain</span></div>
          <div class="play-overlay" ><svg width="16" height="16" viewBox="0 0 24 24"><path fill="#fff" d="M8 5v14l11-7z"/></svg></div>
        </article>

        <article class="card" data-src="audio/alagasman.mp3">
          <div class="cover">
            <img src="./images/alagasman.jpg" alt="Trending song cover" />
          </div>
          <div style="margin-top:10px;"><strong>Alag Asman</strong><br><span class="muted">Anuv Jain</span></div>
          <div class="play-overlay" aria-hidden="true"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="#fff" d="M8 5v14l11-7z"/></svg></div>
        </article>

        <article class="card" data-src="audio/forareason.mp3">
          <div class="cover">
            <img src="./images/forareason.png" alt="Trending song cover" />
          </div>
          <div style="margin-top:10px;"><strong>For a Reason</strong><br><span class="muted">Karan Aujla</span></div>
          <div class="play-overlay" ><svg width="16" height="16" viewBox="0 0 24 24"><path fill="#fff" d="M8 5v14l11-7z"/></svg></div>
        </article>
      </div>
    </section>


    <section class="section">
      <h2>Top Artists</h2>
      <div class="grid">
        <article class="artist">
          <div class="avatar"><img src="./images/karanaujla4.jpg" alt="Artist portrait"/></div>
          <strong>Karan Aujla</strong>
        </article>
        <article class="artist">
          <div class="avatar"><img src="./images/arjit.jpg" alt="Artist portrait"/></div>
          <strong>Arjit Singh</strong>
        </article>
        <article class="artist">
          <div class="avatar"><img src="./images/lata.jpg" alt="Artist portrait"/></div>
          <strong>lata mangeshkar</strong>
        </article>
        <article class="artist">
          <div class="avatar"><img src="./images/asha.jpg" alt="Artist portrait"/></div>
          <strong>Asha Bhosle</strong>
        </article>
      </div>
    </section>

     
    <section class="section">
      <h2>Albums Collection</h2>
      <div class="grid">
        <article class="album-card" data-src="audio/forareason.mp3">
          <div class="cover"><img src="./images/forareason.png" alt="Album cover"/>
            
          </div>
          <div style="margin-top:8px;">
            <strong>P-POP CULTURE</strong><br><span class="muted">Karan Aujla</span>
          </div>
          <div style="margin-top:10px;">
            <a href="#" class="btn" aria-label="Play album">
              <svg width="16" height="16" viewBox="0 0 24 24" aria-hidden="true"><path fill="currentColor" d="M8 5v14l11-7z"/></svg>
              Play
            </a>
          </div>
        </article>

        <article class="album-card" data-src="audio/jotum.mp3">
          <div class="cover"><img src="./images/jotum.jpg" alt="Album cover"/></div>
          <div style="margin-top:8px;">
            <strong>JO Tum Mere Ho</strong><br><span class="muted">Anuv Jain</span>
          </div>
          <div style="margin-top:10px;">
            <a href="#" class="btn" aria-label="Play album"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentColor" d="M8 5v14l11-7z"/></svg> Play</a>
          </div>
        </article>

        <article class="album-card" data-src="audio/mismatched.mp3">
          <div class="cover"><img src="./images/mis.jpg" alt="Album cover"/></div>
          <div style="margin-top:8px;">
            <strong>Mismatched</strong><br><span class="muted">Anurag Saikia</span>
          </div>
          <div style="margin-top:10px;">
            <a href="#" class="btn" aria-label="Play album"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentColor" d="M8 5v14l11-7z"/></svg> Play</a>
          </div>
        </article>

        <article class="album-card" data-src="audio/yjhd.mp3">
          <div class="cover"><img src="./images/yjhd.jpg" alt="Album cover"/></div>
          <div style="margin-top:8px;">
            <strong>Yeh Jawaani hai Deewani</strong><br><span class="muted">Pritam</span>
          </div>
          <div style="margin-top:10px;">
            <a href="#" class="btn" aria-label="Play album"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentColor" d="M8 5v14l11-7z"/></svg> Play</a>
          </div>
        </article>
      </div>
    </section>

  
    <section class="section">
      <h2>Your Library</h2>
      <div class="list">
        <div class="row">
          <div class="thumb"><img src="./images/lotus.jpg" alt="Saved album cover"/></div>
          <div class="meta">
            <div>Recently Played Mix</div>
            <small>22 songs • Updated today</small>
          </div>
          <a class="btn" href="#" aria-label="Open playlist">Open</a>
        </div>
        <div class="row">
          <div class="thumb"><img src="./images/find.jpg" alt="Saved album cover"/></div>
          <div class="meta">
            <div>Saved Albums</div>
            <small>12 albums</small>
          </div>
          <a class="btn" href="#" aria-label="View albums">View</a>
        </div>
      </div>
    </section>
  </main>

  <!-- Theme script -->
  <script src="theme.js"></script>

  <footer>
    <div class="container footer-grid">
      <div class="footer-links">
        <a href="#">About</a>
        <a href="#">Help</a>
        <a href="#">Privacy Policy</a>
        <a href="#">Terms</a>
      </div>
      <div class="social" aria-label="Social media">
        <a href="#" aria-label="Twitter">
          <svg width="18" height="18" viewBox="0 0 24 24" aria-hidden="true"><path fill="currentColor" d="M4 4h3l5 7l5-7h3l-7.5 10L20 20h-3l-5-7l-5 7H4l7.5-10z"/></svg>
        </a>
        <a href="#" aria-label="Instagram">
          <svg width="18" height="18" viewBox="0 0 24 24" aria-hidden="true"><path fill="currentColor" d="M7 2h10a5 5 0 0 1 5 5v10a5 5 0 0 1-5 5H7a5 5 0 0 1-5-5V7a5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3v10a3 3 0 0 0 3 3h10a3 3 0 0 0 3-3V7a3 3 0 0 0-3-3zm5 3a5 5 0 1 1 0 10a5 5 0 0 1 0-10m0 2.2A2.8 2.8 0 1 0 14.8 12A2.8 2.8 0 0 0 12 9.2M18 6.5a1 1 0 1 1-1 1a1 1 0 0 1 1-1"/></svg>
        </a>
        <a href="#" aria-label="YouTube">
          <svg width="18" height="18" viewBox="0 0 24 24" aria-hidden="true"><path fill="currentColor" d="M10 15V9l5 3m8-6.5v9A3.5 3.5 0 0 1 19.5 18h-15A3.5 3.5 0 0 1 1 14.5v-9A3.5 3.5 0 0 1 4.5 2h15A3.5 3.5 0 0 1 23 5.5"/></svg>
        </a>
      </div>
    </div>
  </footer>
  <script>
  (function (){
    // Player with real audio attempt + graceful simulated fallback
    function qs(sel, ctx){ return (ctx||document).querySelector(sel); }
    function qsa(sel, ctx){ return Array.from((ctx||document).querySelectorAll(sel)); }

    const player = qs('.player');
    if(!player) return;
    const albumImg = qs('.player .album img');
    const titleEl = qs('.player .title');
    const subtitleEl = qs('.player .subtitle');
    const playBtn = qs('.player .play');
    const controlIconBtns = qsa('.player .controls .icon-btn');
    const timeSpans = qsa('.player .progress-wrap .time span');
    const range = qs('.player .progress-wrap input[type="range"]');

    const playSVG = '<svg width="20" height="20" viewBox="0 0 24 24" aria-hidden="true"><path fill="currentColor" d="M8 5v14l11-7z"/></svg>';
    const pauseSVG = '<svg width="18" height="18" viewBox="0 0 24 24" aria-hidden="true"><path fill="currentColor" d="M6 6h2v12H6zM16 6h2v12h-2z"/></svg>';

    // Build tracks from cards, album-cards and rows
    const tracks = [];
    qsa('.scroll-row .card').forEach(card => {
      const img = card.querySelector('.cover img');
      const title = card.querySelector('strong') ? card.querySelector('strong').textContent.trim() : 'Unknown';
      const artist = card.querySelector('.muted') ? card.querySelector('.muted').textContent.trim() : '';
      tracks.push({ title, artist, cover: img ? img.getAttribute('src') : '', sourceEl: card, type: 'card', src: card.dataset && card.dataset.src });
    });
    qsa('.album-card').forEach(card => {
      const img = card.querySelector('.cover img');
      const title = card.querySelector('strong') ? card.querySelector('strong').textContent.trim() : 'Unknown';
      const artist = card.querySelector('.muted') ? card.querySelector('.muted').textContent.trim() : '';
      tracks.push({ title, artist, cover: img ? img.getAttribute('src') : '', sourceEl: card, type: 'album', src: card.dataset && card.dataset.src });
    });
    qsa('aside .list .row').forEach(row => {
      const img = row.querySelector('.thumb img');
      const title = row.querySelector('.meta div') ? row.querySelector('.meta div').textContent.trim() : 'Unknown';
      const artist = row.querySelector('.meta small') ? row.querySelector('.meta small').textContent.trim() : '';
      tracks.push({ title, artist, cover: img ? img.getAttribute('src') : '', sourceEl: row, type: 'row', src: row.dataset && row.dataset.src });
    });
    if(tracks.length === 0){
      tracks.push({ title: titleEl.textContent.trim() || 'Unknown', artist: subtitleEl.textContent.trim() || '', cover: albumImg?albumImg.getAttribute('src'):'' });
    }

    // helper to indicate current playing element
    function markPlaying(){
      tracks.forEach(t => { if(t.sourceEl) t.sourceEl.classList && t.sourceEl.classList.remove('playing'); });
      const t = tracks[currentIndex];
      if(t && t.sourceEl && t.sourceEl.classList) t.sourceEl.classList.add('playing');
    }

    // Audio element
    const audio = new Audio();
    audio.preload = 'metadata';

    let currentIndex = 0;
    let simulatedTimer = null;
    let usingAudioElement = false; // whether real audio is active

    function formatTime(s){ s = Math.max(0, Math.floor(s)); const m = Math.floor(s/60); const sec = s%60; return m + ':' + (sec < 10 ? '0' + sec : sec); }

    function updateTimeUIFromAudio(){
      const currentTime = usingAudioElement ? (isFinite(audio.currentTime) ? audio.currentTime : 0) : (player._simCurrentTime || 0);
      const duration = usingAudioElement ? (isFinite(audio.duration) ? audio.duration : 0) : (player._simDuration || 0);
      if(timeSpans.length >= 2){ timeSpans[0].textContent = formatTime(currentTime); timeSpans[1].textContent = formatTime(duration); }
      if(range){ const pct = duration ? Math.round((currentTime/duration) * 100) : 0; range.value = pct; }
    }

    function updatePlayerUI(){ 
      const t = tracks[currentIndex]; 
      if(t){ 
        if(albumImg && t.cover) albumImg.src = t.cover; 
        titleEl.textContent = t.title || 'Unknown'; 
        subtitleEl.textContent = t.artist || ''; 
        markPlaying(); 
        updateRowPlayButtons(); // Update play/pause icons in "Playing Now" rows
      } 
    }

    // Helper to update row play button icons
    function updateRowPlayButtons(){
      qsa('.list .row button[aria-label="Play"]').forEach((btn, idx) => {
        const row = btn.closest('.row');
        const rowIndex = tracks.findIndex(t => t.sourceEl === row);
        const isCurrentTrack = rowIndex === currentIndex;
        const isPlaying = usingAudioElement ? !audio.paused : !!simulatedTimer;
        
        // Update SVG icon based on state
        if(isCurrentTrack && isPlaying){
          // Show pause icon
          btn.innerHTML = '<svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentColor" d="M6 6h2v12H6zM16 6h2v12h-2z"/></svg>';
        } else {
          // Show play icon
          btn.innerHTML = '<svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentColor" d="M8 5v14l11-7z"/></svg>';
        }
      });
    }

    function stopSimulated(){ if(simulatedTimer){ clearInterval(simulatedTimer); simulatedTimer = null; } }

    function startSimulated(resetTime = false){ // fallback simulated playback
      usingAudioElement = false;
      stopSimulated();
      if(resetTime || !player._simDuration){
        player._simDuration = 180 + (currentIndex % 5) * 30;
        player._simCurrentTime = 0;
      }
      playBtn.innerHTML = pauseSVG;
      simulatedTimer = setInterval(()=>{ player._simCurrentTime += 1; if(player._simCurrentTime >= player._simDuration){ nextTrack(); } updateTimeUIFromAudio(); }, 1000);
    }

    function pauseSimulated(){ stopSimulated(); playBtn.innerHTML = playSVG; }

    async function tryLoadAudioCandidates(candidates){
      for(const c of candidates){
        try{
          audio.src = c;
          const ok = await new Promise((resolve) => {
            let done = false;
            function clean(){ audio.removeEventListener('loadedmetadata', onLoad); audio.removeEventListener('error', onError); }
            function onLoad(){ if(done) return; done = true; clean(); resolve(true); }
            function onError(){ if(done) return; done = true; clean(); resolve(false); }
            audio.addEventListener('loadedmetadata', onLoad);
            audio.addEventListener('error', onError);
            try{ audio.load(); }catch(e){ onError(); }
            setTimeout(()=>{ if(done) return; done = true; clean(); resolve(false); }, 1500);
          });
          if(ok) return c;
        }catch(e){ /* ignore and try next */ }
      }
      return null;
    }

    async function loadTrack(index, autoPlay = false){
      if(index < 0) index = tracks.length - 1;
      currentIndex = index % tracks.length;
      updatePlayerUI();

      const t = tracks[currentIndex];
      const candidates = [];
      
      // Try API search first
      if(typeof MusicAPI !== 'undefined'){
        try{
          const api = new MusicAPI();
          console.log('Searching API for:', t.title, t.artist);
          const result = await api.searchSong(t.title, t.artist);
          
          if(result && result.preview_url){
            candidates.push(result.preview_url);
            
            // Update cover art if API provides better quality
            if(result.album_cover && albumImg){
              albumImg.src = result.album_cover;
              t.cover = result.album_cover;
            }
            console.log('✓ Found on API:', result.title);
          }
        } catch(e){
          console.log('API search failed:', e.message);
        }
      }
      
      // Add local file candidates as fallback
      if(t && t.src) candidates.push(t.src);
      if(t && t.cover){
        const cover = t.cover.split('?')[0].split('#')[0];
        const m = cover.match(/(^.*\/)?([^\/]+?)\.(jpg|jpeg|png|webp|avif)$/i);
        if(m){ const dir = m[1] || ''; const name = m[2]; candidates.push(dir + name + '.mp3'); candidates.push(dir + name + '.m4a'); candidates.push(dir + name + '.wav'); candidates.push('audio/' + name + '.mp3'); candidates.push('songs/' + name + '.mp3'); }
      }

      // try to find a valid audio file
      const found = await tryLoadAudioCandidates(candidates);
      audio.onended = null; audio.ontimeupdate = null;

      if(found){
        usingAudioElement = true;
        audio.src = found;
        audio.onplay = ()=>{ playBtn.innerHTML = pauseSVG; updateRowPlayButtons(); };
        audio.onpause = ()=>{ playBtn.innerHTML = playSVG; updateRowPlayButtons(); };
        audio.ontimeupdate = updateTimeUIFromAudio;
        audio.onended = ()=>{ nextTrack(); };
        try{ if(autoPlay) await audio.play(); }catch(e){ /* autoplay blocked */ }
        updateTimeUIFromAudio();
      }else{
        usingAudioElement = false;
        try{ audio.pause(); }catch(e){}
        startSimulated(true); // reset time when loading new track
      }
    }

    async function play(){ 
      if(usingAudioElement){ 
        try{ await audio.play(); updateRowPlayButtons(); }catch(e){} 
      } else { 
        startSimulated(false); 
        updateRowPlayButtons(); 
      } 
    } // resume from current position
    function pause(){ 
      if(usingAudioElement){ 
        audio.pause(); 
      } else { 
        pauseSimulated(); 
      } 
      updateRowPlayButtons(); 
    }
    function togglePlay(){ if(usingAudioElement ? !audio.paused : !!simulatedTimer) { pause(); } else { play(); } }
    function nextTrack(){ loadTrack((currentIndex + 1) % tracks.length, true); }
    function prevTrack(){ loadTrack((currentIndex - 1 + tracks.length) % tracks.length, true); }

    // Wire up controls
    if(playBtn) playBtn.addEventListener('click', (e)=>{ e.preventDefault(); togglePlay(); });
    if(controlIconBtns && controlIconBtns.length >= 2){ controlIconBtns[0].addEventListener('click', (e)=>{ e.preventDefault(); prevTrack(); }); controlIconBtns[1].addEventListener('click', (e)=>{ e.preventDefault(); nextTrack(); }); }

    // Click to play on cards/rows
    qsa('.scroll-row .card, .album-card, aside .list .row').forEach((el, idx)=>{
      el.style.cursor = 'pointer';
      el.addEventListener('click', (ev)=>{
        const tag = ev.target.tagName.toLowerCase();
        if(tag === 'a' || tag === 'button' || ev.target.closest('a') || ev.target.closest('button')) return;
        const targetIndex = tracks.findIndex(t => t.sourceEl === el);
        const useIndex = targetIndex >= 0 ? targetIndex : (idx % tracks.length);
        loadTrack(useIndex, true);
      });
    });

    qsa('.list .row button[aria-label="Play"]').forEach(btn => { 
      btn.addEventListener('click', (e)=>{ 
        e.preventDefault(); 
        const row = btn.closest('.row'); 
        const targetIndex = tracks.findIndex(t => t.sourceEl === row); 
        const foundIndex = targetIndex >= 0 ? targetIndex : 0;
        // If clicking the currently playing track, toggle play/pause
        if(foundIndex === currentIndex){
          togglePlay();
        } else {
          // Load and play the new track
          loadTrack(foundIndex, true);
        }
      }); 
    });

    // play-overlay and album play buttons
    qsa('.play-overlay').forEach((overlay, i)=>{ overlay.addEventListener('click', (e)=>{ e.stopPropagation(); loadTrack(i, true); }); });
    // album-card play anchors
    qsa('.album-card a.btn[aria-label]').forEach(btn => {
      btn.addEventListener('click', (e)=>{
        const album = btn.closest('.album-card');
        const targetIndex = tracks.findIndex(t => t.sourceEl === album);
        if(targetIndex >= 0){ e.preventDefault(); loadTrack(targetIndex, true); }
      });
    });

    // Range interactions (seeking)
    if(range){
      range.addEventListener('input', ()=>{
        const pct = Math.max(0, Math.min(100, Number(range.value)));
        if(usingAudioElement && isFinite(audio.duration) ){ audio.currentTime = (pct/100) * audio.duration; }
        else { player._simCurrentTime = Math.round((pct/100) * (player._simDuration || 1)); updateTimeUIFromAudio(); }
      });
    }

    // Keyboard space toggles play
    document.addEventListener('keydown', (e)=>{ if(e.code === 'Space' && document.activeElement && document.activeElement.tagName.toLowerCase() !== 'input' && document.activeElement.tagName.toLowerCase() !== 'textarea'){ e.preventDefault(); togglePlay(); } });

    // Search
    const searchForm = qs('form.search'); if(searchForm){ searchForm.addEventListener('submit', (e)=>{ e.preventDefault(); const q = (qs('#q') && qs('#q').value) || ''; const url = 'songs.html' + (q ? ('?q=' + encodeURIComponent(q)) : ''); window.location.href = url; }); }

    // Initialize first track but don't autoplay
    loadTrack(0, false);

    // Expose for debugging
    player._catifyy = { tracks, loadTrack, play, pause, togglePlay, audio };
  })();
  </script>

  <!-- Music API Integration -->
  <script src="music-api.js"></script>
</body>
</html>